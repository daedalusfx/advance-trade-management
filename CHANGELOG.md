
این نسخه از یک معماری پایدار مبتنی بر **Short Polling HTTP** استفاده می‌کند که در آن اکسپرت با یک مکانیزم صف داخلی، از تداخل در ارسال داده‌ها جلوگیری می‌کند.

---
## لاگ تغییرات (Changelog)

### [نسخه 2.5.0] - معماری پایدار Polling با مدیریت وضعیت - (تاریخ فعلی)

این نسخه بر پایداری ارتباط، جلوگیری از خرابی داده‌ها و افزودن منطق کامل مدیریت معاملات تمرکز دارد.

---
### اکسپرت (`api.c`)

#### بهبودها (Changed)
- **معماری ارسال داده غیرمسدودکننده:** برای حل مشکل تداخل درخواست‌های وب و خرابی داده‌ها، یک مکانیزم صف داخلی (`g_data_queue`) و پرچم وضعیت (`g_is_sending`) پیاده‌سازی شد. اکسپرت اکنون داده‌ها را در یک صف قرار داده و به صورت کنترل‌شده ارسال می‌کند.
- **مدیریت کامل وضعیت ATM:** منطق کامل برای فعال/غیرفعال کردن مدیریت خودکار برای هر معامله به صورت مجزا (`ToggleAtmForTicket`) پیاده‌سازی شد.
- **انتقال به فرمت JSON:** فرمت تبادل داده با سرور به طور کامل به JSON استاندارد تغییر یافت.

#### ویژگی‌ها (Added)
- **منطق جامع مدیریت خودکار (`ProcessAutoManagement`):** قابلیت‌های پیشرفته‌ای مانند بستن بخشی از حجم، ریسک-فری کردن خودکار و اجرای قوانین بر اساس درصد سود هدف، به اکسپرت اضافه شد.
- **پایداری وضعیت حد ضرر (Stop Loss):** حد ضررهای اولیه معاملات در یک فایل `.dat` ذخیره می‌شوند تا در صورت ری‌استارت شدن اکسپرت، اطلاعات از بین نرود.

#### رفع اشکال (Fixed)
- **رفع باگ `Content-Length`:** مشکل حیاتی که باعث خطای تجزیه JSON در سرور می‌شد، با حذف کاراکتر `\0` از انتهای داده ارسالی به طور کامل حل شد.

---
### سرور (`server.js`)

#### بهبودها (Changed)
- **پشتیبانی کامل از دستورات جدید:** سرور برای دریافت و مدیریت تمام دستورات جدید ارسال شده از داشبورد (مانند `update_settings`, `toggle_auto` و...) به‌روزرسانی شد.
- **دریافت مستقیم JSON:** سرور برای پذیرش مستقیم داده‌های JSON از اکسپرت بهینه شد و دیگر نیازی به تجزیه رشته‌های متنی سفارشی ندارد.

#### ویژگی‌ها (Added)
- **ارتباط دوطرفه با داشبورد:** با استفاده از WebSocket، داده‌های دریافتی از اکسپرت به صورت لحظه‌ای به تمام داشبوردهای متصل ارسال می‌شود.
- **مدیریت تنظیمات:** یک `endpoint` برای دریافت و به‌روزرسانی تنظیمات مدیریت خودکار از طریق داشبورد اضافه شد.

---
### داشبورد پایتون (`app.py`)

*(این لاگ بر اساس فایل‌های قبلی شماست و با این نسخه از اکسپرت و سرور کاملاً هماهنگ است)*

#### بهبودها (Changed)
- **معماری جدول به `Model/View` تغییر یافت:** برای افزایش عملکرد و پایداری، جدول نمایش معاملات بازنویسی شد.
- **استایل‌ها به فایل‌های `.qss` منتقل شدند:** برای خوانایی بهتر، کدهای CSS به فایل‌های خارجی منتقل شدند.

#### رفع اشکال (Fixed)
- **رفع کرش برنامه:** مشکل از کار افتادن برنامه هنگام کلیک روی دکمه "بستن معامله" برطرف شد.
- **افزودن بازخورد خطا:** اکنون در صورت عدم موفقیت در ارسال دستور، کاربر با یک پیغام خطا مطلع می‌شود.